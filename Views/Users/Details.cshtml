@using Microsoft.AspNetCore.Identity
@inject UserManager<ApplicationUser> userManager
@model dejtingsajt.Models.MessageViewModel


@{
    ViewData["Title"] = "Details";
}

<h1>Details</h1>

<div>
    <h4> @Html.DisplayFor(model => model.applicationUser.Name)</h4>
    <hr />
    <dl class="row">
        <dd class="col-sm-10">
            @if (@Model.applicationUser.Photo != null)
            {
                <img id="profilePicture" style="width:150px;height:150px; object-fit:cover" src="data:image/*;base64,@(Convert.ToBase64String(@Model.applicationUser.Photo))">
            }
            else
            {
                <img id="profilePicture" style="width: 150px; height:150px; object-fit: cover; border-radius: 30px" src="/images/download.jpg">
            }
        </dd>

        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.applicationUser.Gender)
        </dt>
        <dd class="col-sm-4">
            @Html.DisplayFor(model => model.applicationUser.Gender)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.applicationUser.Age)
        </dt>
        <dd class="col-sm-">
            @Html.DisplayFor(model => model.applicationUser.Age)
        </dd>
    </dl>
</div>
<div>
    @foreach (var send in Model.MessagesSender.Zip(Model.messagesList, (user, msg) => user.Name + ": " + msg.Content))
    {


            <p class="the-comment">@send</p>
           
        

    }

</div>
<div class="form-group">
    <h3>Vägg</h3>
    <textarea class="form-control" id="text" height: 103px;" placeholder="Add your text here..."></textarea>
    <input type="button" id="post" class="btn btn-primary" value="Post" />
</div>

<div>

    <a asp-controller="Friends" asp-action="FriendsList" asp-route-id="@Model.applicationUser.Id">Friends</a>

</div>
@if (Model.applicationUser.Id.Equals(userManager.GetUserId(User)))
{
    <div>

        <a asp-action="Edit" asp-route-id="@Model.applicationUser.Id">Edit</a> |
        <a asp-action="Delete" asp-route-id="@Model.applicationUser.Id">Delete</a> |
        <a asp-action="Index">Back to List</a>
    </div>
}

else
{

    <div class="col-md-2">
        <input type="button" class="btn btn-primary" value="Add Friend" onclick="location.href='@Url.Action("AddFriend", "Friends", new { id = Model.applicationUser.Id })'" />

    </div>


}

<script src="//code.jquery.com/jquery-1.10.2.js"></script>
<script type="text/javascript">


$('#post').click(function () {


    var obj = {
        Content:  $('#text').val(),
        ReceiverId:"@Model.applicationUser.Id"
    };
    var msg = JSON.stringify(obj);

    $.ajax({
        type: "POST",
        data: msg,
        contentType: "application/json; charset=UTF-8",
        url: "/api/Messages/sendMessage",
        success: function (data) {
            $('#text').val('');
           window.location.reload();
 }

    });
});

</script>


